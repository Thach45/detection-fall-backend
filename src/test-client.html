<!DOCTYPE html>
<html>
<head>
    <title>Socket.IO Test Client</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <h2>Socket.IO Test Client</h2>
    <div id="status">Tr·∫°ng th√°i: Ch∆∞a k·∫øt n·ªëi</div>
    <div id="transport">Transport: -</div>
    <div id="messages"></div>

    <script>
        const socket = io('http://localhost:3000', {
            transports: ['websocket', 'polling'],
            reconnectionAttempts: 5,
            reconnectionDelay: 1000,
            timeout: 20000
        });

        // X·ª≠ l√Ω k·∫øt n·ªëi
        socket.on('connect', () => {
            document.getElementById('status').textContent = 'Tr·∫°ng th√°i: ƒê√£ k·∫øt n·ªëi';
            document.getElementById('transport').textContent = `Transport: ${socket.io.engine.transport.name}`;
            console.log('‚úÖ Socket.IO connected');
        });

        // X·ª≠ l√Ω x√°c nh·∫≠n k·∫øt n·ªëi t·ª´ server
        socket.on('connection_confirmed', (data) => {
            console.log('Server confirmed connection:', data);
            document.getElementById('messages').innerHTML = `
                <div style="border: 1px solid #green; margin: 10px; padding: 10px;">
                    <h3>‚úÖ K·∫øt n·ªëi th√†nh c√¥ng</h3>
                    <p>Socket ID: ${data.socketId}</p>
                    <p>Transport: ${data.transport}</p>
                </div>
            ` + document.getElementById('messages').innerHTML;
        });

        // X·ª≠ l√Ω ng·∫Øt k·∫øt n·ªëi
        socket.on('disconnect', (reason) => {
            document.getElementById('status').textContent = 'Tr·∫°ng th√°i: M·∫•t k·∫øt n·ªëi';
            document.getElementById('transport').textContent = 'Transport: -';
            console.log('‚ùå Socket.IO disconnected:', reason);
        });

        // X·ª≠ l√Ω l·ªói
        socket.on('connect_error', (error) => {
            console.error('Connection error:', error);
            document.getElementById('status').textContent = 'Tr·∫°ng th√°i: L·ªói k·∫øt n·ªëi';
        });

        // L·∫Øng nghe th√¥ng b√°o t√© ng√£
        socket.on('fall_detected', (data) => {
            console.log('Received fall alert:', data);
            document.getElementById('messages').innerHTML = `
                <div style="border: 1px solid #red; margin: 10px; padding: 10px;">
                    <h3>üö® C·∫£nh b√°o t√© ng√£!</h3>
                    <p>Thi·∫øt b·ªã: ${data.deviceId}</p>
                    <p>V·ªã tr√≠: ${JSON.stringify(data.location)}</p>
                    <p>Th·ªùi gian: ${data.timestamp}</p>
                    <p>Tin nh·∫Øn: ${data.message}</p>
                </div>
            ` + document.getElementById('messages').innerHTML;
        });
    </script>
</body>
</html>